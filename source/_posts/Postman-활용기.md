---
title: Postman 활용기
date: 2019-06-21 23:31:27
tags: ["Postman"]
---

오늘은 회사에서 일을 하면서 API 테스트를 위해 포스트맨을 활용했던 경험을 기록해보고자 한다. 

기존에 포스트맨을 사용해봤던 경험은 있다. 사용은 했지만 활용을 해서 보다 작업을 진행하는데 편리했다고는 느껴보지 못했다. 왜냐하면 지극히 일부의 기능만을 사용했었기 때문이다. 

또한 매번 직접 값을 지정해주고 결과값을 받아 확인만 해보았을 뿐 포스트맨의 여러 기능들을 적극적으로 활용해보진 못했고 그러한 기능들이 있는지조차 몰랐다. 

하지만 사내 테크톡에서 서버팀 팀장님이 발표해주신 내용으로 포스트맨에 정말 다양하고 유용한 기능들이 있으며 이를 적극 활용한다면 업무의 효율을 상당히 높일 수 있다는 사실을 알게 되었다. 

테크톡에서 다룬 모든 기능을 사용해보고 이를 소개하는 것은 아니지만 내가 직접 사용해보고 간단하지만 편리하다고 생각했던 기능들을 위주로 소개해보려 한다. 



### Global, Environment 변수 활용

---

코드를 작성할 때도 전역 변수와 지역 변수가 존재한다. 우리는 변수를 사용해서 선언부의 값만 변경하면 이를 사용하는 모든 곳에 영향을 줄 수 있다. 즉 유지 보수가 수월하다. 포스트맨에서도 동일하다. 

![](https://ehdrjsdlzzzz.github.io/2019/06/21/Postman-활용기/Environment.png)

먼저 우측 상단의 톱니 바퀴 모양을 클릭하면 다음과 같이 환경 변수를 지정할 수 있는 윈도우가 나타난다. 본인은 여기서 개발 서버, 스테이징 서버 그리고 프로덕션 서버로 환경을 나누어 관리하고 있다. 

기본적으로 서버의 환경에 따라 URL이 달라지고 토큰 값도 달라질 수 있기 때문에 **서버 환경에 따라 변하는 값들은 환경별로 나누어 관리**를 하고 있다. 

![](https://ehdrjsdlzzzz.github.io/2019/06/21/Postman-활용기/globals.png)

다음은 전역 변수 개념의 글로벌이다. 위의 환경 변수를 관리하는 윈도우의 하단 버튼 세 개중 가장 왼쪽 버튼을 누르면 글로벌 변수를 관리할 수 있는 화면으로 넘어가는데 보통 여기선 **서버 환경에 상관없이 동일한 값을 사용하는 값들을 이곳에 관리**한다. 예를 들면 서버의 환경에 상관없이 요청을 보내는 디바이스는 동일하고 운영체제는 동일하기 때문에 이러한 값들은 이곳에서 관리를 한다. 

이곳에서 변수들을 한 번 입력해놓으면 우리는 요청을 보내는 화면에서 쉽게 변수를 통해 해당 값을 사용할 수 있다.

예를 들어 위에서 언급된 곳에서 `VARIABLE`이 `api-token`이고 `VALUE`가 `as@4#!@=13412`이라면 헤더 필드에 값을 변수에 해당하는 값을 넣어주고 싶을 때 로 해당 변수를 줄괄호 쌍 두개로 감싸서 (이를 입력하면 타이포라에서 렌더링 에러가 발생한다.😅) 입력하면 `as@4#!@=13412`를 사용할 수 있다.

> 기본적으로 자동 완성을 지원한다. 



### Script 사용하기

---

기본적으로 상용 앱들은 회원가입과 로그인 개념이 있고 이를 바탕으로 서비스를 제공한다. 그렇기 때문에 사용자 인증 토큰은 필수로 사용하게 되고 인증 토큰은 일정 기간이 되면 만료되는 것이 일반적이다. 

포스트맨을 통해 인증 토큰을 실어 API 요청을 보낼 때 인증 토큰이 만료되면 원하는 응답을 받을 수 없다. 우리는 이 때 간단한 스크립트 작성을 통해 로그인 API를 호출하고 그 결과로 반환되는 토큰 정보를 위에서 설명한 변수에 자동으로 할당하여 새로 갱신된 인증 토큰을 사용해 정상적인 API 호출 결과를 얻을 수도 있다.

![](https://ehdrjsdlzzzz.github.io/2019/06/21/Postman-활용기/Test.png)

다음은 로그인을 요청할 때 사용하는 API의 모습이다. 당연히 상세 URL이나 보내는 값은 모자이크 처리를 해놨다. 현재 우리는 위의 사진에서 `Tests` 탭에 위치하고 있다. 그리고 자바스크립트로 작성된 코드가 보인다. 

코드를 요약하자면 로그인 API를 호출한 결과로부터 원하는 토큰 값을 추출해 환경 변수에 담는 코드이다. 

기본적으로 포스트맨에서 제공해주는 메소드들을 사용해 글로벌 변수 혹은 환경 변수에 API 호출 결과값을 할당해줄 수 있다. 위의 사진에서는 `environment`를 통해 현재 환경 변수의 `"x-api-블라블라"` 키의 값에 `jsonData`로 부터 원하는 값을 추출하여 할당하고 있는 코드이다. 

> 전역 변수에 넣고 싶다면 `environment` 대신 `globals`를 사용하면 된다. 

이렇게 코드를 작성하면 조회 API 호출 시 사용자 인증 토큰이 만료된 상태라면 로그인 탭으로 돌아와 요청을 한 번 보내고 다시 조회 API를 호출하면 갱신된 사용자 인증 토큰을 갖고 요청을 보내기 때문에 원하는 결과를 얻을 수 있다.

본인은 위에서 소개한 간단한 기능들만 사용해도 많이 편리해졌다고 느꼈다. 이외에도 요청 보내기 전에 해야 할 일들을 작성해준다거나, 일련의 API를 통합으로 테스트할 수 있다거나 여러 많은 유용한 기능들을 포스트맨에서 지원해주고 있다. 

이들을 적극적으로 활용한다면 보다 수월하게 개발을 진행할 수 있을 것이다. 